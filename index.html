<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wikidata Book Itemizer</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        
        function Bookitemizer() {
          const [formData, setFormData] = useState({
            labelEn: '',
            authorName: '',
            authorQid: '',
            publicationYear: '',
            publisherQid: '',
            isbn: '',
            secondLangCode: 'pa',
            secondLangLabel: '',
            secondLangAuthorName: '',
            punjabiScript: 'Q689894'
          });
          
          const [copied, setCopied] = useState(false);

          const languages = [
            { code: 'pa', name: 'Punjabi (ਪੰਜਾਬੀ)', qid: 'Q58635', hasScriptOption: true },
            { code: 'hi', name: 'Hindi (हिन्दी)', qid: 'Q1568', hasScriptOption: false },
            { code: 'ur', name: 'Urdu (اردو)', qid: 'Q1617', hasScriptOption: false },
            { code: 'bn', name: 'Bengali (বাংলা)', qid: 'Q9610', hasScriptOption: false },
            { code: 'ta', name: 'Tamil (தமிழ்)', qid: 'Q5885', hasScriptOption: false },
            { code: 'te', name: 'Telugu (తెలుగు)', qid: 'Q8097', hasScriptOption: false },
            { code: 'mr', name: 'Marathi (मराठी)', qid: 'Q1571', hasScriptOption: false },
            { code: 'gu', name: 'Gujarati (ગુજરાતી)', qid: 'Q5137', hasScriptOption: false },
            { code: 'kn', name: 'Kannada (ಕನ್ನಡ)', qid: 'Q33673', hasScriptOption: false },
            { code: 'ml', name: 'Malayalam (മലയാളം)', qid: 'Q36236', hasScriptOption: false },
            { code: 'or', name: 'Odia (ଓଡ଼ିଆ)', qid: 'Q33810', hasScriptOption: false },
            { code: 'as', name: 'Assamese (অসমীয়া)', qid: 'Q29401', hasScriptOption: false },
            { code: 'sa', name: 'Sanskrit (संस्कृतम्)', qid: 'Q11059', hasScriptOption: false },
            { code: 'es', name: 'Spanish (Español)', qid: 'Q1321', hasScriptOption: false },
            { code: 'fr', name: 'French (Français)', qid: 'Q150', hasScriptOption: false },
            { code: 'de', name: 'German (Deutsch)', qid: 'Q188', hasScriptOption: false },
            { code: 'zh', name: 'Chinese (中文)', qid: 'Q7850', hasScriptOption: false },
            { code: 'ja', name: 'Japanese (日本語)', qid: 'Q5287', hasScriptOption: false },
            { code: 'ko', name: 'Korean (한국어)', qid: 'Q9176', hasScriptOption: false },
            { code: 'ar', name: 'Arabic (العربية)', qid: 'Q13955', hasScriptOption: false },
            { code: 'ru', name: 'Russian (Русский)', qid: 'Q7737', hasScriptOption: false },
            { code: 'pt', name: 'Portuguese (Português)', qid: 'Q5146', hasScriptOption: false },
            { code: 'it', name: 'Italian (Italiano)', qid: 'Q652', hasScriptOption: false }
          ];

          const punjabiScripts = [
            { qid: 'Q689894', name: 'Gurmukhi (ਗੁਰਮੁਖੀ)' },
            { qid: 'Q202575', name: 'Shahmukhi (شاہ مکھی)' }
          ];

          const getSelectedLanguage = () => {
            return languages.find(lang => lang.code === formData.secondLangCode);
          };

          const validateQID = (value) => {
            // Allow empty or validate Q followed by numbers
            if (value === '') return value;
            const qidPattern = /^Q\d*$/;
            return qidPattern.test(value) ? value : formData.authorQid;
          };

          const validateYear = (value) => {
            // Allow empty or max 4 digits
            if (value === '') return value;
            const yearPattern = /^\d{0,4}$/;
            return yearPattern.test(value) ? value : formData.publicationYear;
          };

          const handleAuthorQidChange = (e) => {
            const value = e.target.value.toUpperCase();
            setFormData({...formData, authorQid: validateQID(value)});
          };

          const handlePublisherQidChange = (e) => {
            const value = e.target.value.toUpperCase();
            setFormData({...formData, publisherQid: validateQID(value)});
          };

          const handleYearChange = (e) => {
            const value = e.target.value;
            setFormData({...formData, publicationYear: validateYear(value)});
          };

          const getISBNProperty = () => {
            const year = parseInt(formData.publicationYear);
            if (!year || isNaN(year)) return null;
            return year <= 2006 ? 'P957' : 'P212';
          };

          const generateQuickStatements = () => {
            if (!formData.labelEn || !formData.authorName) {
              return '';
            }

            let qs = '';
            const workP31 = 'Q47461344';
            const editionP31 = 'Q3331189';
            
            // Work Item
            qs += 'CREATE\n';
            qs += `LAST|Len|"${formData.labelEn}"\n`;
            if (formData.secondLangLabel && formData.secondLangCode) {
              qs += `LAST|L${formData.secondLangCode}|"${formData.secondLangLabel}"\n`;
            }
            
            const workDescEn = `work by ${formData.authorName}`;
            qs += `LAST|Den|"${workDescEn}"\n`;
            if (formData.secondLangLabel && formData.secondLangAuthorName && formData.secondLangCode) {
              const secondLangDescMap = {
                'pa': `${formData.secondLangAuthorName} ਦੀ ਰਚਨਾ`,
                'hi': `${formData.secondLangAuthorName} की रचना`,
                'ur': `${formData.secondLangAuthorName} کی تخلیق`
              };
              const secondLangDesc = secondLangDescMap[formData.secondLangCode] || `work by ${formData.secondLangAuthorName}`;
              qs += `LAST|D${formData.secondLangCode}|"${secondLangDesc}"\n`;
            }
            
            qs += `LAST|P31|${workP31}\n`;
            
            if (formData.authorQid) {
              qs += `LAST|P50|${formData.authorQid}\n`;
            } else {
              qs += `LAST|P2093|"${formData.authorName}"\n`;
            }
            
            const selectedLang = getSelectedLanguage();
            if (selectedLang) {
              if (selectedLang.hasScriptOption && formData.secondLangCode === 'pa') {
                qs += `LAST|P407|${selectedLang.qid}|P282|${formData.punjabiScript}\n`;
              } else {
                qs += `LAST|P407|${selectedLang.qid}\n`;
              }
            }
            
            qs += '\n';
            
            // Edition Item
            qs += 'CREATE\n';
            qs += `LAST|Len|"${formData.labelEn}"\n`;
            if (formData.secondLangLabel && formData.secondLangCode) {
              qs += `LAST|L${formData.secondLangCode}|"${formData.secondLangLabel}"\n`;
            }
            
            const yearPart = formData.publicationYear ? `${formData.publicationYear} ` : '';
            const editionDescEn = `${yearPart}edition of work by ${formData.authorName}`;
            qs += `LAST|Den|"${editionDescEn}"\n`;
            if (formData.secondLangLabel && formData.secondLangAuthorName && formData.secondLangCode) {
              const editionDescMap = {
                'pa': formData.publicationYear 
                  ? `${formData.secondLangAuthorName} ਦੀ ਰਚਨਾ ਦੀ ${formData.publicationYear} ਛਾਪ`
                  : `${formData.secondLangAuthorName} ਦੀ ਰਚਨਾ ਦੀ ਛਾਪ`,
                'hi': formData.publicationYear
                  ? `${formData.secondLangAuthorName} की रचना का ${formData.publicationYear} संस्करण`
                  : `${formData.secondLangAuthorName} की रचना का संस्करण`,
                'ur': formData.publicationYear
                  ? `${formData.secondLangAuthorName} کی تخلیق کا ${formData.publicationYear} ایڈیشن`
                  : `${formData.secondLangAuthorName} کی تخلیق کا ایڈیشن`
              };
              const editionDesc = editionDescMap[formData.secondLangCode] || 
                `${yearPart}edition of work by ${formData.secondLangAuthorName}`;
              qs += `LAST|D${formData.secondLangCode}|"${editionDesc}"\n`;
            }
            
            qs += `LAST|P31|${editionP31}\n`;
            
            if (formData.authorQid) {
              qs += `LAST|P50|${formData.authorQid}\n`;
            } else {
              qs += `LAST|P2093|"${formData.authorName}"\n`;
            }
            
            const selectedLangEdition = getSelectedLanguage();
            if (selectedLangEdition) {
              if (selectedLangEdition.hasScriptOption && formData.secondLangCode === 'pa') {
                qs += `LAST|P407|${selectedLangEdition.qid}|P282|${formData.punjabiScript}\n`;
              } else {
                qs += `LAST|P407|${selectedLangEdition.qid}\n`;
              }
            }
            
            if (formData.publisherQid) {
              qs += `LAST|P123|${formData.publisherQid}\n`;
            }
            
            if (formData.publicationYear) {
              qs += `LAST|P577|+${formData.publicationYear}-00-00T00:00:00Z/9\n`;
            }
            
            if (formData.isbn) {
              const isbnProperty = getISBNProperty();
              if (isbnProperty) {
                qs += `LAST|${isbnProperty}|"${formData.isbn}"\n`;
              }
            }
            
            return qs;
          };

          const handleCopy = () => {
            const qs = generateQuickStatements();
            navigator.clipboard.writeText(qs);
            setCopied(true);
            setTimeout(() => setCopied(false), 2000);
          };

          const handleOpenQuickStatements = () => {
            const qs = generateQuickStatements();
            if (!qs) return;
            
            const qsV1Format = qs.replace(/\n/g, '||');
            const textarea = document.getElementById('qs_commands');
            textarea.value = qsV1Format;
            document.getElementById('qs_form').submit();
          };

          const output = generateQuickStatements();
          const isbnProperty = getISBNProperty();

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
              <form 
                style={{display: 'none'}} 
                id="qs_form" 
                action="https://quickstatements.toolforge.org/api.php" 
                method="post" 
                target="_blank"
              >
                <input type="hidden" name="action" value="import" />
                <input type="hidden" name="format" value="v1" />
                <input type="hidden" name="temporary" value="1" />
                <input type="hidden" name="openpage" value="1" />
                <input type="hidden" name="site" value="wikidata" />
                <textarea type="hidden" id="qs_commands" name="data"></textarea>
                <button name="yup"></button>
              </form>

              <div className="max-w-4xl mx-auto">
                <div className="bg-white rounded-lg shadow-lg p-8 mb-6">
                  <h1 className="text-3xl font-bold text-indigo-900 mb-2">
                    Wikidata Book Itemizer
                  </h1>
                  <p className="text-gray-600 mb-6">
                    Easily Create work and edition items
                  </p>
                  
                  <div className="space-y-6">
                    <div className="border-b pb-6">
                      <h3 className="text-lg font-semibold text-gray-800 mb-4">Labels</h3>
                      <div className="space-y-4">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">
                            Label (English) *
                          </label>
                          <input
                            type="text"
                            value={formData.labelEn}
                            onChange={(e) => setFormData({...formData, labelEn: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                            placeholder="e.g., Example Book"
                            required
                          />
                        </div>
                        
                        <div className="grid md:grid-cols-2 gap-4">
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                              Local Language
                            </label>
                            <select
                              value={formData.secondLangCode}
                              onChange={(e) => setFormData({...formData, secondLangCode: e.target.value})}
                              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                            >
                              {languages.map(lang => (
                                <option key={lang.code} value={lang.code}>{lang.name}</option>
                              ))}
                            </select>
                          </div>
                          
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                              Label in Local Language
                            </label>
                            <input
                              type="text"
                              value={formData.secondLangLabel}
                              onChange={(e) => setFormData({...formData, secondLangLabel: e.target.value})}
                              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                              placeholder="e.g., ਉਦਾਹਰਨ ਕਿਤਾਬ"
                            />
                          </div>
                        </div>

                        {formData.secondLangCode === 'pa' && (
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                              Punjabi Script
                            </label>
                            <select
                              value={formData.punjabiScript}
                              onChange={(e) => setFormData({...formData, punjabiScript: e.target.value})}
                              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                            >
                              {punjabiScripts.map(script => (
                                <option key={script.qid} value={script.qid}>{script.name}</option>
                              ))}
                            </select>
                          </div>
                        )}
                      </div>
                    </div>

                    <div className="border-b pb-6">
                      <h3 className="text-lg font-semibold text-gray-800 mb-4">Author Information</h3>
                      <div className="space-y-4">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">
                            Author Name (English) *
                          </label>
                          <input
                            type="text"
                            value={formData.authorName}
                            onChange={(e) => setFormData({...formData, authorName: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                            placeholder="Author Name"
                            required
                          />
                          <p className="text-xs text-gray-500 mt-1">Used in English description and P2093 if no Q-ID provided</p>
                        </div>
                        
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">
                            Author Name in Local Language
                          </label>
                          <input
                            type="text"
                            value={formData.secondLangAuthorName}
                            onChange={(e) => setFormData({...formData, secondLangAuthorName: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                            placeholder="e.g., ਲੇਖਕ ਦਾ ਨਾਮ"
                          />
                          <p className="text-xs text-gray-500 mt-1">Used in local language description</p>
                        </div>
                        
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">
                            Author Q-ID
                          </label>
                          <input
                            type="text"
                            value={formData.authorQid}
                            onChange={handleAuthorQidChange}
                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                            placeholder="Q123456"
                            pattern="^Q\d+$"
                          />
                          <p className="text-xs text-gray-500 mt-1">Format: Q followed by numbers (e.g., Q123456). If available, P50 will be used; otherwise P2093 with author name</p>
                        </div>
                      </div>
                    </div>

                    <div className="border-b pb-6">
                      <h3 className="text-lg font-semibold text-gray-800 mb-4">Publication Information</h3>
                      <div className="space-y-4">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">
                            Publisher Q-ID (P123)
                          </label>
                          <input
                            type="text"
                            value={formData.publisherQid}
                            onChange={handlePublisherQidChange}
                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                            placeholder="Q123456"
                            pattern="^Q\d+$"
                          />
                          <p className="text-xs text-gray-500 mt-1">Format: Q followed by numbers. Wikidata Q-ID of the publisher (edition only)</p>
                        </div>
                        
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">
                            Publication Year (P577)
                          </label>
                          <input
                            type="text"
                            value={formData.publicationYear}
                            onChange={handleYearChange}
                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                            placeholder="e.g., 2024"
                            maxLength="4"
                            pattern="\d{4}"
                          />
                          <p className="text-xs text-gray-500 mt-1">4-digit year only. Used in edition description and P577 statement (edition only)</p>
                        </div>
                        
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-1">
                            ISBN {isbnProperty && `(${isbnProperty === 'P957' ? 'ISBN-10' : 'ISBN-13'})`}
                          </label>
                          <input
                            type="text"
                            value={formData.isbn}
                            onChange={(e) => setFormData({...formData, isbn: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                            placeholder={isbnProperty === 'P957' ? 'e.g., 0-123-45678-9' : 'e.g., 978-0-123-45678-9'}
                          />
                          <p className="text-xs text-gray-500 mt-1">
                            {formData.publicationYear ? 
                              (parseInt(formData.publicationYear) <= 2006 ? 
                                'ISBN-10 format (P957) - up to 2006' : 
                                'ISBN-13 format (P212) - from 2007 onwards') 
                              : 'Enter publication year first to determine ISBN format'}
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="bg-white rounded-lg shadow-lg p-8">
                  <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 mb-4">
                    <h2 className="text-xl font-semibold text-gray-900">
                      QuickStatements Output
                    </h2>
                    <div className="flex gap-2">
                      <button
                        onClick={handleCopy}
                        disabled={!output}
                        className="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"
                      >
                        {copied ? (
                          <>
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                            </svg>
                            Copied!
                          </>
                        ) : (
                          <>
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                            Copy
                          </>
                        )}
                      </button>
                      
                      <button
                        onClick={handleOpenQuickStatements}
                        disabled={!output}
                        className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"
                      >
                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                        </svg>
                        Create in QuickStatements
                      </button>
                    </div>
                  </div>
                  
                  <pre className="bg-gray-50 border border-gray-200 rounded-md p-4 overflow-x-auto text-sm font-mono whitespace-pre-wrap min-h-[200px]">
                    {output || 'Fill in the required fields (English label and author name) to generate QuickStatements...'}
                  </pre>
                  
                  {output && (
                    <div className="mt-3 p-3 bg-green-50 border border-green-200 rounded-md">
                      <p className="text-sm text-green-800">
                        <strong>✓ Ready!</strong> Click "Create in QuickStatements" to open the tool with your commands pre-loaded. Just login and click "Import" to create both items instantly!
                      </p>
                    </div>
                  )}
                  
                  <div className="mt-4 text-sm text-gray-600">
                    <p className="font-semibold mb-2">Auto-generated descriptions:</p>
                    <ul className="list-disc list-inside space-y-1">
                      <li><strong>Work:</strong> "work by [author name]"</li>
                      <li><strong>Edition:</strong> "[publication year] edition of work by [author name]"</li>
                    </ul>
                    <p className="font-semibold mt-3 mb-2">Properties included:</p>
                    <ul className="list-disc list-inside space-y-1">
                      <li>P31 = Instance of (Q47461344 for work, Q3331189 for edition)</li>
                      <li>P50 = Author (if Q-ID provided) OR P2093 = Author name string (if no Q-ID)</li>
                      <li>P123 = Publisher (edition only, if provided)</li>
                      <li>P407 = Language of work (with P282 qualifier for Punjabi script selection)</li>
                      <li>P577 = Publication date (edition only)</li>
                      <li>P957 = ISBN-10 (for publications up to 2006) OR P212 = ISBN-13 (from 2007 onwards)</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          );
        }
        
        ReactDOM.render(<Bookitemizer />, document.getElementById('root'));
    </script>
</body>
</html>
