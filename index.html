<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wikidata Book Itemizer</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class'
      }
    </script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        function Bookitemizer() {
          const [formData, setFormData] = useState({
            labelEn: '',
            authorName: '',
            authorQid: '',
            publicationYear: '',
            publisherQid: '',
            isbn: '',
            secondLangCode: 'pa',
            secondLangLabel: '',
            secondLangAuthorName: '',
            punjabiScript: 'Q689894'
          });
          
          const [copied, setCopied] = useState(false);
          const [darkMode, setDarkMode] = useState(false);
          
          const [authorSearchQuery, setAuthorSearchQuery] = useState('');
          const [authorSearchResults, setAuthorSearchResults] = useState([]);
          const [showAuthorResults, setShowAuthorResults] = useState(false);
          const [authorLoading, setAuthorLoading] = useState(false);
          
          const [publisherSearchQuery, setPublisherSearchQuery] = useState('');
          const [publisherSearchResults, setPublisherSearchResults] = useState([]);
          const [showPublisherResults, setShowPublisherResults] = useState(false);
          const [publisherLoading, setPublisherLoading] = useState(false);
          
          const authorSearchRef = useRef(null);
          const publisherSearchRef = useRef(null);

          useEffect(() => {
            const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            setDarkMode(isDark);
            if (isDark) {
              document.documentElement.classList.add('dark');
            }
          }, []);

          useEffect(() => {
            const handleClickOutside = (event) => {
              if (authorSearchRef.current && !authorSearchRef.current.contains(event.target)) {
                setShowAuthorResults(false);
              }
              if (publisherSearchRef.current && !publisherSearchRef.current.contains(event.target)) {
                setShowPublisherResults(false);
              }
            };
            document.addEventListener('mousedown', handleClickOutside);
            return () => document.removeEventListener('mousedown', handleClickOutside);
          }, []);

          const toggleDarkMode = () => {
            setDarkMode(!darkMode);
            document.documentElement.classList.toggle('dark');
          };

          const fetchItemLabels = async (qid, langCode) => {
            try {
              const response = await fetch(
                `https://www.wikidata.org/w/api.php?action=wbgetentities&ids=${qid}&props=labels&languages=en|${langCode}&format=json&origin=*`
              );
              const data = await response.json();
              const entity = data.entities[qid];
              
              if (entity && entity.labels) {
                return {
                  en: entity.labels.en?.value || '',
                  local: entity.labels[langCode]?.value || ''
                };
              }
              return { en: '', local: '' };
            } catch (error) {
              console.error('Error fetching item labels:', error);
              return { en: '', local: '' };
            }
          };

          const searchWikidata = async (query, type) => {
            if (query.length < 2) return [];
            
            try {
              const response = await fetch(
                `https://www.wikidata.org/w/api.php?action=wbsearchentities&search=${encodeURIComponent(query)}&language=en&limit=10&format=json&origin=*&type=item`
              );
              const data = await response.json();
              const results = data.search || [];
              return results.map(item => ({
                id: item.id,
                label: item.label,
                description: item.description || 'No description available'
              }));
            } catch (error) {
              console.error('Wikidata search error:', error);
              return [];
            }
          };

          const handleAuthorSearch = async (value) => {
            setAuthorSearchQuery(value);
            setShowAuthorResults(true);
            
            if (value.length < 2) {
              setAuthorSearchResults([]);
              return;
            }
            
            setAuthorLoading(true);
            const results = await searchWikidata(value, 'author');
            setAuthorSearchResults(results);
            setAuthorLoading(false);
          };

          const handlePublisherSearch = async (value) => {
            setPublisherSearchQuery(value);
            setShowPublisherResults(true);
            
            if (value.length < 2) {
              setPublisherSearchResults([]);
              return;
            }
            
            setPublisherLoading(true);
            const results = await searchWikidata(value, 'publisher');
            setPublisherSearchResults(results);
            setPublisherLoading(false);
          };

          const selectAuthor = async (result) => {
            setFormData({...formData, authorQid: result.id});
            setAuthorSearchQuery(result.label);
            setShowAuthorResults(false);
            
            // Fetch labels from Wikidata
            const labels = await fetchItemLabels(result.id, formData.secondLangCode);
            
            // Update author names if labels exist in Wikidata
            setFormData(prev => ({
              ...prev,
              authorQid: result.id,
              authorName: labels.en || prev.authorName,
              secondLangAuthorName: labels.local || prev.secondLangAuthorName
            }));
          };

          const selectPublisher = (result) => {
            setFormData({...formData, publisherQid: result.id});
            setPublisherSearchQuery(result.label);
            setShowPublisherResults(false);
          };

          const clearAuthorSearch = () => {
            setFormData({...formData, authorQid: '', authorName: '', secondLangAuthorName: ''});
            setAuthorSearchQuery('');
            setAuthorSearchResults([]);
          };

          const clearPublisherSearch = () => {
            setFormData({...formData, publisherQid: ''});
            setPublisherSearchQuery('');
            setPublisherSearchResults([]);
          };

          const languages = [
            { code: 'pa', name: 'Punjabi (ਪੰਜਾਬੀ)', qid: 'Q58635', hasScriptOption: true, placeholder: 'ਉਦਾਹਰਨ ਕਿਤਾਬ', authorPlaceholder: 'ਲੇਖਕ ਦਾ ਨਾਮ' },
            { code: 'hi', name: 'Hindi (हिन्दी)', qid: 'Q1568', hasScriptOption: false, placeholder: 'उदाहरण पुस्तक', authorPlaceholder: 'लेखक का नाम' },
            { code: 'ur', name: 'Urdu (اردو)', qid: 'Q1617', hasScriptOption: false, placeholder: 'مثال کتاب', authorPlaceholder: 'مصنف کا نام' },
            { code: 'bn', name: 'Bengali (বাংলা)', qid: 'Q9610', hasScriptOption: false, placeholder: 'উদাহরণ বই', authorPlaceholder: 'লেখকের নাম' },
            { code: 'ta', name: 'Tamil (தமிழ்)', qid: 'Q5885', hasScriptOption: false, placeholder: 'உதாரண புத்தகம்', authorPlaceholder: 'ஆசிரியர் பெயர்' },
            { code: 'te', name: 'Telugu (తెలుగు)', qid: 'Q8097', hasScriptOption: false, placeholder: 'ఉదాహరణ పుస్తకం', authorPlaceholder: 'రచయిత పేరు' },
            { code: 'mr', name: 'Marathi (मराठी)', qid: 'Q1571', hasScriptOption: false, placeholder: 'उदाहरण पुस्तक', authorPlaceholder: 'लेखकाचे नाव' },
            { code: 'gu', name: 'Gujarati (ગુજરાતી)', qid: 'Q5137', hasScriptOption: false, placeholder: 'ઉદાહરણ પુસ્તક', authorPlaceholder: 'લેખકનું નામ' },
            { code: 'kn', name: 'Kannada (ಕನ್ನಡ)', qid: 'Q33673', hasScriptOption: false, placeholder: 'ಉದಾಹರಣೆ ಪುಸ್ತಕ', authorPlaceholder: 'ಲೇಖಕರ ಹೆಸರು' },
            { code: 'ml', name: 'Malayalam (മലയാളം)', qid: 'Q36236', hasScriptOption: false, placeholder: 'ഉദാഹരണ പുസ്തകം', authorPlaceholder: 'രചയിതാവിന്റെ പേര്' },
            { code: 'or', name: 'Odia (ଓଡ଼ିଆ)', qid: 'Q33810', hasScriptOption: false, placeholder: 'ଉଦାହରଣ ପୁସ୍ତକ', authorPlaceholder: 'ଲେଖକଙ୍କ ନାମ' },
            { code: 'as', name: 'Assamese (অসমীয়া)', qid: 'Q29401', hasScriptOption: false, placeholder: 'উদাহৰণ কিতাপ', authorPlaceholder: 'লেখকৰ নাম' },
            { code: 'sa', name: 'Sanskrit (संस्कृतम्)', qid: 'Q11059', hasScriptOption: false, placeholder: 'उदाहरणपुस्तकम्', authorPlaceholder: 'लेखकस्य नाम' },
            { code: 'es', name: 'Spanish (Español)', qid: 'Q1321', hasScriptOption: false, placeholder: 'Libro de ejemplo', authorPlaceholder: 'Nombre del autor' },
            { code: 'fr', name: 'French (Français)', qid: 'Q150', hasScriptOption: false, placeholder: 'Livre exemple', authorPlaceholder: 'Nom de l\'auteur' },
            { code: 'de', name: 'German (Deutsch)', qid: 'Q188', hasScriptOption: false, placeholder: 'Beispielbuch', authorPlaceholder: 'Autorenname' },
            { code: 'zh', name: 'Chinese (中文)', qid: 'Q7850', hasScriptOption: false, placeholder: '示例书籍', authorPlaceholder: '作者姓名' },
            { code: 'ja', name: 'Japanese (日本語)', qid: 'Q5287', hasScriptOption: false, placeholder: '例の本', authorPlaceholder: '著者名' },
            { code: 'ko', name: 'Korean (한국어)', qid: 'Q9176', hasScriptOption: false, placeholder: '예제 책', authorPlaceholder: '저자 이름' },
            { code: 'ar', name: 'Arabic (العربية)', qid: 'Q13955', hasScriptOption: false, placeholder: 'كتاب مثال', authorPlaceholder: 'اسم المؤلف' },
            { code: 'ru', name: 'Russian (Русский)', qid: 'Q7737', hasScriptOption: false, placeholder: 'Пример книги', authorPlaceholder: 'Имя автора' },
            { code: 'pt', name: 'Portuguese (Português)', qid: 'Q5146', hasScriptOption: false, placeholder: 'Livro de exemplo', authorPlaceholder: 'Nome do autor' },
            { code: 'it', name: 'Italian (Italiano)', qid: 'Q652', hasScriptOption: false, placeholder: 'Libro di esempio', authorPlaceholder: 'Nome dell\'autore' }
          ];

          const punjabiScripts = [
            { qid: 'Q689894', name: 'Gurmukhi (ਗੁਰਮੁਖੀ)' },
            { qid: 'Q202575', name: 'Shahmukhi (شاہ مکھی)' }
          ];

          const getSelectedLanguage = () => {
            return languages.find(lang => lang.code === formData.secondLangCode);
          };

          const validateYear = (value) => {
            if (value === '') return value;
            const yearPattern = /^\d{0,4}$/;
            return yearPattern.test(value) ? value : formData.publicationYear;
          };

          const handleYearChange = (e) => {
            const value = e.target.value;
            setFormData({...formData, publicationYear: validateYear(value)});
          };

          const getISBNProperty = () => {
            const year = parseInt(formData.publicationYear);
            if (!year || isNaN(year)) return null;
            return year <= 2006 ? 'P957' : 'P212';
          };

          const generateQuickStatements = () => {
            if (!formData.labelEn || !formData.authorName) {
              return '';
            }

            let qs = '';
            const workP31 = 'Q47461344';
            const editionP31 = 'Q3331189';
            
            qs += 'CREATE\n';
            qs += `LAST|Len|"${formData.labelEn}"\n`;
            if (formData.secondLangLabel && formData.secondLangCode) {
              qs += `LAST|L${formData.secondLangCode}|"${formData.secondLangLabel}"\n`;
            }
            
            const workDescEn = `work by ${formData.authorName}`;
            qs += `LAST|Den|"${workDescEn}"\n`;
            if (formData.secondLangLabel && formData.secondLangAuthorName && formData.secondLangCode) {
              const secondLangDescMap = {
                'pa': `${formData.secondLangAuthorName} ਦੀ ਰਚਨਾ`,
                'hi': `${formData.secondLangAuthorName} की रचना`,
                'ur': `${formData.secondLangAuthorName} کی تخلیق`
              };
              const secondLangDesc = secondLangDescMap[formData.secondLangCode] || `work by ${formData.secondLangAuthorName}`;
              qs += `LAST|D${formData.secondLangCode}|"${secondLangDesc}"\n`;
            }
            
            qs += `LAST|P31|${workP31}\n`;
            
            if (formData.authorQid) {
              qs += `LAST|P50|${formData.authorQid}\n`;
            } else {
              qs += `LAST|P2093|"${formData.authorName}"\n`;
            }
            
            const selectedLang = getSelectedLanguage();
            if (selectedLang) {
              if (selectedLang.hasScriptOption && formData.secondLangCode === 'pa') {
                qs += `LAST|P407|${selectedLang.qid}|P282|${formData.punjabiScript}\n`;
              } else {
                qs += `LAST|P407|${selectedLang.qid}\n`;
              }
            }
            
            qs += '\n';
            
            qs += 'CREATE\n';
            qs += `LAST|Len|"${formData.labelEn}"\n`;
            if (formData.secondLangLabel && formData.secondLangCode) {
              qs += `LAST|L${formData.secondLangCode}|"${formData.secondLangLabel}"\n`;
            }
            
            const yearPart = formData.publicationYear ? `${formData.publicationYear} ` : '';
            const editionDescEn = `${yearPart}edition of work by ${formData.authorName}`;
            qs += `LAST|Den|"${editionDescEn}"\n`;
            if (formData.secondLangLabel && formData.secondLangAuthorName && formData.secondLangCode) {
              const editionDescMap = {
                'pa': formData.publicationYear 
                  ? `${formData.secondLangAuthorName} ਦੀ ਰਚਨਾ ਦੀ ${formData.publicationYear} ਛਾਪ`
                  : `${formData.secondLangAuthorName} ਦੀ ਰਚਨਾ ਦੀ ਛਾਪ`,
                'hi': formData.publicationYear
                  ? `${formData.secondLangAuthorName} की रचना का ${formData.publicationYear} संस्करण`
                  : `${formData.secondLangAuthorName} की रचना का संस्करण`,
                'ur': formData.publicationYear
                  ? `${formData.secondLangAuthorName} کی تخلیق کا ${formData.publicationYear} ایڈیشن`
                  : `${formData.secondLangAuthorName} کی تخلیق کا ایڈیشن`
              };
              const editionDesc = editionDescMap[formData.secondLangCode] || 
                `${yearPart}edition of work by ${formData.secondLangAuthorName}`;
              qs += `LAST|D${formData.secondLangCode}|"${editionDesc}"\n`;
            }
            
            qs += `LAST|P31|${editionP31}\n`;
            
            if (formData.authorQid) {
              qs += `LAST|P50|${formData.authorQid}\n`;
            } else {
              qs += `LAST|P2093|"${formData.authorName}"\n`;
            }
            
            const selectedLangEdition = getSelectedLanguage();
            if (selectedLangEdition) {
              if (selectedLangEdition.hasScriptOption && formData.secondLangCode === 'pa') {
                qs += `LAST|P407|${selectedLangEdition.qid}|P282|${formData.punjabiScript}\n`;
              } else {
                qs += `LAST|P407|${selectedLangEdition.qid}\n`;
              }
            }
            
            if (formData.publisherQid) {
              qs += `LAST|P123|${formData.publisherQid}\n`;
            }
            
            if (formData.publicationYear) {
              qs += `LAST|P577|+${formData.publicationYear}-00-00T00:00:00Z/9\n`;
            }
            
            if (formData.isbn) {
              const isbnProperty = getISBNProperty();
              if (isbnProperty) {
                qs += `LAST|${isbnProperty}|"${formData.isbn}"\n`;
              }
            }
            
            return qs;
          };

          const handleCopy = () => {
            const qs = generateQuickStatements();
            navigator.clipboard.writeText(qs);
            setCopied(true);
            setTimeout(() => setCopied(false), 2000);
          };

          const handleOpenQuickStatements = () => {
            const qs = generateQuickStatements();
            if (!qs) return;
            
            const qsV1Format = qs.replace(/\n/g, '||');
            const textarea = document.getElementById('qs_commands');
            textarea.value = qsV1Format;
            document.getElementById('qs_form').submit();
          };

          const output = generateQuickStatements();
          const isbnProperty = getISBNProperty();
          const selectedLanguage = getSelectedLanguage();

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 p-6 transition-colors duration-200">
              <form 
                style={{display: 'none'}} 
                id="qs_form" 
                action="https://quickstatements.toolforge.org/api.php" 
                method="post" 
                target="_blank"
              >
                <input type="hidden" name="action" value="import" />
                <input type="hidden" name="format" value="v1" />
                <input type="hidden" name="temporary" value="1" />
                <input type="hidden" name="openpage" value="1" />
                <input type="hidden" name="site" value="wikidata" />
                <textarea type="hidden" id="qs_commands" name="data"></textarea>
                <button name="yup"></button>
              </form>

              <div className="max-w-4xl mx-auto">
                <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8 mb-6 transition-colors duration-200">
                  <div className="flex justify-between items-center mb-6">
                    <div>
                      <h1 className="text-3xl font-bold text-indigo-900 dark:text-indigo-300 mb-2">
                        Wikidata Book Itemizer
                      </h1>
                      <p className="text-gray-600 dark:text-gray-300">
                        Easily Create work and edition items
                      </p>
                    </div>
                    <button
                      onClick={toggleDarkMode}
                      className="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
                      aria-label="Toggle dark mode"
                    >
                      {darkMode ? (
                        <svg className="w-6 h-6 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                      ) : (
                        <svg className="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                        </svg>
                      )}
                    </button>
                  </div>
                  
                  <div className="space-y-6">
                    <div className="border-b border-gray-200 dark:border-gray-700 pb-6">
                      <h3 className="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Labels</h3>
                      <div className="space-y-4">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Label (English) *
                          </label>
                          <input
                            type="text"
                            value={formData.labelEn}
                            onChange={(e) => setFormData({...formData, labelEn: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
                            placeholder="e.g., Example Book"
                            required
                          />
                        </div>
                        
                        <div className="grid md:grid-cols-2 gap-4">
                          <div>
                            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                              Local Language
                            </label>
                            <select
                              value={formData.secondLangCode}
                              onChange={(e) => setFormData({...formData, secondLangCode: e.target.value})}
                              className="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
                            >
                              {languages.map(lang => (
                                <option key={lang.code} value={lang.code}>{lang.name}</option>
                              ))}
                            </select>
                          </div>
                          
                          <div>
                            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                              Label in Local Language
                            </label>
                            <input
                              type="text"
                              value={formData.secondLangLabel}
                              onChange={(e) => setFormData({...formData, secondLangLabel: e.target.value})}
                              className="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
                              placeholder={selectedLanguage?.placeholder || 'e.g., Example Book'}
                            />
                          </div>
                        </div>

                        {formData.secondLangCode === 'pa' && (
                          <div>
                            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                              Punjabi Script
                            </label>
                            <select
                              value={formData.punjabiScript}
                              onChange={(e) => setFormData({...formData, punjabiScript: e.target.value})}
                              className="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
                            >
                              {punjabiScripts.map(script => (
                                <option key={script.qid} value={script.qid}>{script.name}</option>
                              ))}
                            </select>
                          </div>
                        )}
                      </div>
                    </div>

                    <div className="border-b border-gray-200 dark:border-gray-700 pb-6">
                      <h3 className="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Author Information</h3>
                      <div className="space-y-4">
                        {/* Author Q-ID - Now First */}
                        <div className="relative" ref={authorSearchRef}>
                          <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Author Q-ID
                          </label>
                          <div className="relative">
                            <input
                              type="text"
                              value={formData.authorQid ? `${formData.authorQid} (${authorSearchQuery})` : authorSearchQuery}
                              onChange={(e) => {
                                if (!formData.authorQid) {
                                  handleAuthorSearch(e.target.value);
                                }
                              }}
                              onFocus={() => {
                                if (!formData.authorQid && authorSearchQuery.length >= 2) {
                                  setShowAuthorResults(true);
                                }
                              }}
                              className="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 pr-10"
                              placeholder="Search for author..."
                            />
                            {formData.authorQid && (
                              <button
                                type="button"
                                onClick={clearAuthorSearch}
                                className="absolute right-2 top-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"
                                title="Clear selection"
                              >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                </svg>
                              </button>
                            )}
                            {authorLoading && (
                              <div className="absolute right-2 top-2">
                                <svg className="animate-spin h-5 w-5 text-indigo-600" fill="none" viewBox="0 0 24 24">
                                  <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                  <path className="opacity-75" fill="current Color" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                              </div>
                            )}
                          </div>
                          
                          {showAuthorResults && authorSearchResults.length > 0 && (
                            <div className="absolute z-10 w-full mt-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-lg max-h-60 overflow-y-auto">
                              {authorSearchResults.map((result) => (
                                <div
                                  key={result.id}
                                  onClick={() => selectAuthor(result)}
                                  className="px-4 py-3 hover:bg-indigo-50 dark:hover:bg-gray-600 cursor-pointer border-b border-gray-200 dark:border-gray-600 last:border-b-0"
                                >
                                  <div className="font-medium text-gray-900 dark:text-gray-100">
                                    {result.label} <span className="text-sm text-gray-500 dark:text-gray-400">({result.id})</span>
                                  </div>
                                  <div className="text-sm text-gray-600 dark:text-gray-400">{result.description}</div>
                                </div>
                              ))}
                            </div>
                          )}
                          
                          <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">
                            Search and select author from Wikidata. Names will be auto-filled if available.
                          </p>
                        </div>

                        {/* Author Name English */}
                        <div>
                          <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Author Name (English) *
                          </label>
                          <input
                            type="text"
                            value={formData.authorName}
                            onChange={(e) => setFormData({...formData, authorName: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
                            placeholder="Author Name"
                            required
                          />
                          <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">
                            {formData.authorQid ? 'Auto-filled from Wikidata or edit manually' : 'Used in English description and P2093 if no Q-ID provided'}
                          </p>
                        </div>
                        
                        {/* Author Name Local Language */}
                        <div>
                          <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Author Name in Local Language
                          </label>
                          <input
                            type="text"
                            value={formData.secondLangAuthorName}
                            onChange={(e) => setFormData({...formData, secondLangAuthorName: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
                            placeholder={selectedLanguage?.authorPlaceholder || 'e.g., Author Name'}
                          />
                          <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">
                            {formData.authorQid ? 'Auto-filled from Wikidata or edit manually' : 'Used in local language description'}
                          </p>
                        </div>
                      </div>
                    </div>

                    <div className="border-b border-gray-200 dark:border-gray-700 pb-6">
                      <h3 className="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Publication Information</h3>
                      <div className="space-y-4">
                        <div className="relative" ref={publisherSearchRef}>
                          <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Publisher (P123)
                          </label>
                          <div className="relative">
                            <input
                              type="text"
                              value={formData.publisherQid ? `${formData.publisherQid} (${publisherSearchQuery})` : publisherSearchQuery}
                              onChange={(e) => {
                                if (!formData.publisherQid) {
                                  handlePublisherSearch(e.target.value);
                                }
                              }}
                              onFocus={() => {
                                if (!formData.publisherQid && publisherSearchQuery.length >= 2) {
                                  setShowPublisherResults(true);
                                }
                              }}
                              className="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 pr-10"
                              placeholder="Search for publisher..."
                            />
                            {formData.publisherQid && (
                              <button
                                type="button"
                                onClick={clearPublisherSearch}
                                className="absolute right-2 top-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"
                                title="Clear selection"
                              >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                </svg>
                              </button>
                            )}
                            {publisherLoading && (
                              <div className="absolute right-2 top-2">
                                <svg className="animate-spin h-5 w-5 text-indigo-600" fill="none" viewBox="0 0 24 24">
                                  <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                  <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                              </div>
                            )}
                          </div>
                          
                          {showPublisherResults && publisherSearchResults.length > 0 && (
                            <div className="absolute z-10 w-full mt-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-lg max-h-60 overflow-y-auto">
                              {publisherSearchResults.map((result) => (
                                <div
                                  key={result.id}
                                  onClick={() => selectPublisher(result)}
                                  className="px-4 py-3 hover:bg-indigo-50 dark:hover:bg-gray-600 cursor-pointer border-b border-gray-200 dark:border-gray-600 last:border-b-0"
                                >
                                  <div className="font-medium text-gray-900 dark:text-gray-100">
                                    {result.label} <span className="text-sm text-gray-500 dark:text-gray-400">({result.id})</span>
                                  </div>
                                  <div className="text-sm text-gray-600 dark:text-gray-400">{result.description}</div>
                                </div>
                              ))}
                            </div>
                          )}
                          
                          <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">Search for publisher from Wikidata (edition only)</p>
                        </div>
                        
                        <div>
                          <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Publication Year (P577)
                          </label>
                          <input
                            type="text"
                            value={formData.publicationYear}
                            onChange={handleYearChange}
                            className="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
                            placeholder="e.g., 2024"
                            maxLength="4"
                            pattern="\d{4}"
                          />
                          <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">4-digit year only. Used in edition description and P577 statement (edition only)</p>
                        </div>
                        
                        <div>
                          <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            ISBN {isbnProperty && `(${isbnProperty === 'P957' ? 'ISBN-10' : 'ISBN-13'})`}
                          </label>
                          <input
                            type="text"
                            value={formData.isbn}
                            onChange={(e) => setFormData({...formData, isbn: e.target.value})}
                            className="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
                            placeholder={isbnProperty === 'P957' ? 'e.g., 0-123-45678-9' : 'e.g., 978-0-123-45678-9'}
                          />
                          <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">
                            {formData.publicationYear ? 
                              (parseInt(formData.publicationYear) <= 2006 ? 
                                'ISBN-10 format (P957) - up to 2006' : 
                                'ISBN-13 format (P212) - from 2007 onwards') 
                              : 'Enter publication year first to determine ISBN format'}
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8 mb-6 transition-colors duration-200">
                  <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 mb-4">
                    <h2 className="text-xl font-semibold text-gray-900 dark:text-gray-100">
                      QuickStatements Output
                    </h2>
                    <div className="flex gap-2">
                      <button
                        onClick={handleCopy}
                        disabled={!output}
                        className="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"
                      >
                        {copied ? (
                          <>
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                            </svg>
                            Copied!
                          </>
                        ) : (
                          <>
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                            Copy
                          </>
                        )}
                      </button>
                      
                      <button
                        onClick={handleOpenQuickStatements}
                        disabled={!output}
                        className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed"
                      >
                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                        </svg>
                        Create in QuickStatements
                      </button>
                    </div>
                  </div>
                  
                  <pre className="bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-md p-4 overflow-x-auto text-sm font-mono whitespace-pre-wrap min-h-[200px] text-gray-900 dark:text-gray-100">
                    {output || 'Fill in the required fields (English label and author name) to generate QuickStatements...'}
                  </pre>
                  
                  {output && (
                    <div className="mt-3 p-3 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800 rounded-md">
                      <p className="text-sm text-green-800 dark:text-green-200">
                        <strong>✓ Ready!</strong> Click "Create in QuickStatements" to open the tool with your commands pre-loaded. Just login and click "Import" to create both items instantly!
                      </p>
                    </div>
                  )}
                  
                  <div className="mt-4 text-sm text-gray-600 dark:text-gray-400">
                    <p className="font-semibold mb-2">Auto-generated descriptions:</p>
                    <ul className="list-disc list-inside space-y-1">
                      <li><strong>Work:</strong> "work by [author name]"</li>
                      <li><strong>Edition:</strong> "[publication year] edition of work by [author name]"</li>
                    </ul>
                    <p className="font-semibold mt-3 mb-2">Properties included:</p>
                    <ul className="list-disc list-inside space-y-1">
                      <li>P31 = Instance of (Q47461344 for work, Q3331189 for edition)</li>
                      <li>P50 = Author (if Q-ID provided) OR P2093 = Author name string (if no Q-ID)</li>
                      <li>P123 = Publisher (edition only, if provided)</li>
                      <li>P407 = Language of work (with P282 qualifier for Punjabi script selection)</li>
                      <li>P577 = Publication date (edition only)</li>
                      <li>P957 = ISBN-10 (for publications up to 2006) OR P212 = ISBN-13 (from 2007 onwards)</li>
                    </ul>
                  </div>
                </div>

                <footer className="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 text-center transition-colors duration-200">
                  <div className="flex flex-col sm:flex-row items-center justify-center gap-4 text-sm text-gray-600 dark:text-gray-400">
                    <div className="flex items-center gap-2">
                      <span>Made with</span>
                      <svg className="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fillRule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clipRule="evenodd" />
                      </svg>
                      <span>by</span>
                      <a 
                        href="https://meta.wikimedia.org/wiki/User:Kuldeepburjbhalaike" 
                        target="_blank" 
                        rel="noopener noreferrer"
                        className="text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 font-medium"
                      >
                        Kuldeep
                      </a>
                    </div>
                    <span className="hidden sm:inline text-gray-400 dark:text-gray-600">|</span>
                    <a 
                      href="https://github.com/kuldeepburjbhalaike/BookItemizer" 
                      target="_blank" 
                      rel="noopener noreferrer"
                      className="flex items-center gap-2 text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300"
                    >
                      <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path fillRule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clipRule="evenodd" />
                      </svg>
                      Source Code
                    </a>
                  </div>
                </footer>
              </div>
            </div>
          );
        }
        
        ReactDOM.render(<Bookitemizer />, document.getElementById('root'));
    </script>
</body>
</html>
